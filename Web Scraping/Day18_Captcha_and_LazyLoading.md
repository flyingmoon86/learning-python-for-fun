# Day 18：验证码与延迟加载机制

## 一、验证码类型与作用

**验证码（CAPTCHA，全称 Completely Automated Public Turing test to tell Computers and Humans Apart）**  
是网站用来区分 “人类” 和 “机器” 的一种安全机制，常用于防止自动化爬虫、批量注册、刷票等。

**常见类型**

| 类型 | 示例 | 特点 | 处理方式 |
|------|------|------|----------|
| 文字型验证码 | 输入一串扭曲文字（如 `aBc9`） | 最基础、较简单 | 手动输入 或 OCR 识别 |
| 图片选择型 | 选出“所有有红绿灯的图片” | 用于复杂语义判断 | 人工识别 或 AI 模型识别（难度高） |
| 滑块验证码 | 拖动滑块使拼图对齐 | 常见于登录/注册，具交互性 | 模拟滑动轨迹（复杂）或用浏览器自动化 |
| 点选验证码 | 按提示点击图片中目标 | 更强的人机验证能力 | 通常需 Selenium 等工具模拟或人工处理 |

---

## 二、网页延迟加载机制（Lazy Loading）

现代网页通常不会一次性加载页面上的所有数据（如图片、视频、评论、商品列表等），而采用 **延迟加载**（Lazy Loading）或按需加载，通过 JavaScript 在用户滚动或触发某些事件时再发起请求加载更多数据。

**示例流程**
1. 打开页面，初始 HTML 只包含页面骨架或第一屏内容。  
2. 浏览器执行 JS，JS 发起 AJAX 请求（XHR / Fetch）获取后续数据（通常返回 JSON）。  
3. JS 将返回的数据插入到 DOM 中，页面显示完整内容。

**为什么网站这么做？**
- 节省带宽，提高首屏加载速度  
- 提升用户体验（更快看到首屏内容）  
- 减少服务器压力（按需加载）

**对爬虫的影响**：数据不是在初始 HTML 中，需要额外处理才能拿到完整内容。

---

## 三、处理思路（常用方法）

### 1. 直接找接口（最推荐）
- 打开浏览器开发者工具（F12 → Network → XHR/Fetch）。  
- 滚动或触发页面操作，观察新增的网络请求（通常返回 JSON）。  
- 复制该请求的 URL、参数与必要的 headers，用 `requests` 直接请求该接口获取数据。

### 2. 使用浏览器自动化（Selenium / Playwright）
当无法直接拿到接口或接口需要复杂 JS 执行时，使用浏览器自动化让浏览器自己执行 JS 并渲染页面，之后抓取 `page_source` 或通过 DOM 定位提取数据。

示例（模拟下拉加载更多）：
```python
from selenium import webdriver
import time

driver = webdriver.Edge()
driver.get("https://example.com")

# 模拟下拉加载更多
for _ in range(5):
    driver.execute_script("window.scrollTo(0, document.body.scrollHeight);")
    time.sleep(2)

html = driver.page_source
driver.quit()
```

### 3. 验证码应对策略
- **开发/调试阶段**：手动输入验证码最直接。  
- **小量自动化**：可以接入 OCR（识别文字型验证码）或第三方打码平台（付费）。  
- **滑块 / 点选 / 图片识别**：通常较难，可能需要更复杂的图像识别模型或用 Selenium 模拟真实拖拽和点击（并非万能）。  
- **合理替代**：如果可能，使用登录态 Cookies、官方 API 或联系网站获取授权数据，避免绕过验证码。

---

## 📌 小结

| 内容 | 要点 |
|------|------|
| 验证码 | 是网站防爬的核心措施，类型多样（文字、图片选择、滑块、点选），处理难度不同 |
| 延迟加载 | 数据通过 JS/AJAX 动态加载，初始 HTML 不含完整数据 |
| 应对方式 | 优先抓取后台接口（JSON）；无法时用 Selenium 类工具；遇验证码时考虑人工、第三方识别或合法授权 |
