# Day 19ï¼šåçˆ¬ç­–ç•¥ï¼ˆéšæœº User-Agentã€ä»£ç† IPï¼‰

## ğŸ¯ å­¦ä¹ ç›®æ ‡
- ä½¿ç”¨éšæœº **User-Agent** æ¥é™ä½è¢«è¯†åˆ«ä¸ºçˆ¬è™«çš„æ¦‚ç‡  
- ä½¿ç”¨ **ä»£ç† IP** æé«˜åŒ¿åæ€§ä¸ç»•è¿‡ç®€å•çš„ IP é™åˆ¶  

---

## ä¸€ã€ä¸ºä»€ä¹ˆéœ€è¦è¿™äº›ç­–ç•¥ï¼Ÿ
- è®¸å¤šç½‘ç«™é€šè¿‡æ£€æµ‹è¯·æ±‚å¤´ï¼ˆå¦‚ `User-Agent`ï¼‰æˆ–çŸ­æ—¶é—´å†…å¤§é‡è¯·æ±‚æ¥è‡ªåŒä¸€ IP æ¥åˆ¤å®šéäººç±»æµé‡ï¼Œä»è€Œè¿”å› 403ã€429 æˆ–ç›´æ¥å°ç¦ IPã€‚  
- é€šè¿‡**éšæœºåŒ– User-Agent**ã€**ä½¿ç”¨ä»£ç†æ± **å’Œ**æ§åˆ¶è®¿é—®é¢‘ç‡**ï¼Œå¯ä»¥æ˜¾è‘—é™ä½è¢«å°çš„é£é™©ï¼Œä½†ä¸èƒ½ä¿è¯ç™¾åˆ†ä¹‹ç™¾å®‰å…¨ã€‚

---

## äºŒã€ç¤ºä¾‹ä»£ç ï¼ˆåŸºç¡€ç‰ˆï¼šéšæœº UA + å•ä»£ç†ï¼‰

```python
import requests
import random

user_agents = [
    "Mozilla/5.0 (Windows NT 10.0; Win64; x64)",
    "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7)"
]

proxies = {
    "http": "http://127.0.0.1:8080",
    "https": "https://127.0.0.1:8080"
}

headers = {"User-Agent": random.choice(user_agents)}
response = requests.get("https://www.example.com", headers=headers, proxies=proxies, timeout=8)
print(response.status_code)
```

---

## ä¸‰ã€è¿›é˜¶ç”¨æ³•ï¼ˆä»£ç†æ±  + é‡è¯• + éšæœºå»¶æ—¶ï¼‰

å»ºè®®ç»“åˆä»£ç†æ± ã€é‡è¯•æœºåˆ¶å’Œéšæœºç­‰å¾…æ¥æé«˜ç¨³å®šæ€§ã€‚

```python
import requests
import random
import time

USER_AGENTS = [
    "Mozilla/5.0 (Windows NT 10.0; Win64; x64)",
    "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7)",
    # ... æ›´å¤š UA
]

PROXY_POOL = [
    "http://1.2.3.4:8000",
    "http://5.6.7.8:8000",
    # ... æ›´å¤šä»£ç†
]

def get_proxy_dict(proxy_url):
    return {"http": proxy_url, "https": proxy_url}

def fetch(url, retries=3):
    for attempt in range(retries):
        ua = random.choice(USER_AGENTS)
        proxy = random.choice(PROXY_POOL)
        headers = {"User-Agent": ua}
        try:
            r = requests.get(url, headers=headers, proxies=get_proxy_dict(proxy), timeout=8)
            if r.status_code == 200:
                return r
            else:
                print("çŠ¶æ€ç :", r.status_code)
        except requests.RequestException as e:
            print("è¯·æ±‚å¼‚å¸¸:", e)
        wait = random.uniform(1, 3)
        time.sleep(wait)
    return None
```

---

## å››ã€ä»£ç†ç±»å‹ä¸è·å–é€”å¾„
- **é€æ˜ä»£ç† / åŒ¿åä»£ç† / é«˜åŒ¿ä»£ç†**ï¼šé«˜åŒ¿ä»£ç†æ›´éš¾è¢«ç›®æ ‡ç«™ç‚¹è¯†åˆ«ä¸ºä»£ç†ã€‚  
- **å…è´¹ä»£ç†**ï¼šä¸å¯é ã€é€Ÿåº¦æ…¢ä¸”å¸¸å¤±æ•ˆï¼Œé€‚åˆå­¦ä¹ å’Œæµ‹è¯•ã€‚  
- **ä»˜è´¹ä»£ç†æœåŠ¡**ï¼šæ›´ç¨³å®šï¼Œæ”¯æŒå¤§é‡å¹¶å‘ä¸åœ°ç†ä½ç½®é€‰æ‹©ï¼ˆæ¨èç”Ÿäº§ç¯å¢ƒä½¿ç”¨ï¼‰ã€‚  
- **è´­ä¹°æˆ–æ­å»ºç§æœ‰ä»£ç†æ± **ï¼šé•¿æœŸç¨³å®šæ€§æœ€ä¼˜ï¼Œä½†éœ€è¦è¿ç»´æˆæœ¬ã€‚

---

## äº”ã€å®è·µå»ºè®®ä¸æ³¨æ„äº‹é¡¹
- **ä¸è¦æ»¥ç”¨ä»£ç†**ï¼šé¢‘ç¹è¯·æ±‚ä»ä¼šè¢«ç›®æ ‡æ–¹å‘ç°å¹¶å°ç¦ä»£ç†IPã€‚  
- **éµå®ˆç½‘ç«™ä½¿ç”¨æ¡æ¬¾**ï¼šçˆ¬å–å‰æŸ¥çœ‹ `robots.txt`ã€æœåŠ¡æ¡æ¬¾åŠæ³•å¾‹åˆè§„è¦æ±‚ã€‚  
- **ç»“åˆé¢‘ç‡æ§åˆ¶**ï¼šä½¿ç”¨ `time.sleep()` æˆ–ä»¤ç‰Œæ¡¶ç®—æ³•æ§åˆ¶è¯·æ±‚é€Ÿç‡ã€‚  
- **æ—¥å¿—ä¸ç›‘æ§**ï¼šè®°å½•è¯·æ±‚æˆåŠŸç‡ã€ä»£ç†å¤±æ•ˆç‡ï¼ŒåŠæ—¶æ›¿æ¢å¤±æ•ˆä»£ç†ã€‚  
- **å®‰å…¨**ï¼šä¸è¦æŠŠæ•æ„Ÿå‡­è¯æ”¾åœ¨å…¬å¼€ä»“åº“ï¼›ä»£ç†ä¼šçœ‹åˆ°ä½ å‘å‡ºçš„æ•°æ®ï¼ˆé¿å¼€æ˜æ–‡æ•æ„Ÿä¿¡æ¯ï¼‰ã€‚

---

## å…­ã€å¸¸è§é—®é¢˜ï¼ˆFAQï¼‰
- **Qï¼šéšæœº UA å°±è¶³å¤Ÿäº†å—ï¼Ÿ**  
  Aï¼šä¸æ˜¯ï¼ŒUA åªæ˜¯è¯†åˆ«å› ç´ ä¹‹ä¸€ã€‚è¿˜è¦é…åˆ IP è½®æ¢ã€Refererã€Cookiesã€æ¨¡æ‹Ÿè¡Œä¸ºç­‰ã€‚

- **Qï¼šå…è´¹ä»£ç†è¡Œä¸è¡Œï¼Ÿ**  
  Aï¼šçŸ­æœŸè¯•éªŒå¯ä»¥ï¼Œä½†é•¿æœŸæˆ–æ‰¹é‡çˆ¬å–ä¸æ¨èï¼Œç¨³å®šæ€§å’Œå®‰å…¨æ€§éƒ½æ— æ³•ä¿è¯ã€‚

---

## å‚è€ƒ
- `requests` æ–‡æ¡£ï¼šhttps://requests.readthedocs.io/  
- ä»£ç†æœåŠ¡/æ± å·¥å…·ï¼šä¾‹å¦‚ `proxybroker`ã€`scrapy-rotating-proxies`ï¼ˆåœ¨ Scrapy ä¸­å¸¸ç”¨ï¼‰  
